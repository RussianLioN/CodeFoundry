#!/bin/bash
# Pre-commit hook for {{ project_name }} ({{ archetype }})
# Auto-generated by CodeFoundry

set -e

echo "Running pre-commit checks..."

# Check for secrets
if git diff --cached --name-only | xargs grep -l -E '(api_key|secret|password|token)\s*=' 2>/dev/null; then
  echo "ERROR: Potential secrets detected in staged files"
  exit 1
fi

{% if language == 'python' -%}
# Python syntax check
for f in $(git diff --cached --name-only --diff-filter=ACM -- '*.py'); do
  python3 -c "import ast; ast.parse(open('$f').read())" || {
    echo "ERROR: Python syntax error in $f"
    exit 1
  }
done
{% endif -%}

{% if language in ['typescript', 'javascript'] -%}
# TypeScript/JavaScript lint
if [ -f "node_modules/.bin/eslint" ]; then
  git diff --cached --name-only --diff-filter=ACM -- '*.ts' '*.tsx' '*.js' '*.jsx' | \
    xargs node_modules/.bin/eslint --quiet 2>/dev/null || true
fi
{% endif -%}

{% if docker_enabled -%}
# Dockerfile lint (if hadolint available)
for f in $(git diff --cached --name-only --diff-filter=ACM -- 'Dockerfile*'); do
  if command -v hadolint &>/dev/null; then
    hadolint "$f" || echo "WARNING: Dockerfile lint issues in $f"
  fi
done
{% endif -%}

echo "Pre-commit checks passed."
