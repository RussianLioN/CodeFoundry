# OpenClaw Gateway

WebSocket ัะตัะฒะตั ะดะปั AI-First ะธะฝัะตััะตะนัะฐ CodeFoundry.

## ๐ ะะฟะธัะฐะฝะธะต

Gateway โ ััะพ ัะตะฝััะฐะปัะฝัะน ะบะพะผะฟะพะฝะตะฝั OpenClaw, ะบะพัะพััะน:

- ๐ค ะัะธะฝะธะผะฐะตั ัะพะพะฑัะตะฝะธั ะฝะฐ ััััะบะพะผ ัะทัะบะต ัะตัะตะท WebSocket
- ๐ง ะะฐััะธั ะธะฝัะตะฝัั ั ะฟะพะผะพััั AI (Ollama + gemini-3-flash)
- ๐ฏ ะัะฟะพะปะฝัะตั ะบะพะผะฐะฝะดั (ัะพะทะดะฐะฝะธะต ะฟัะพะตะบัะพะฒ, ะณะตะฝะตัะฐัะธั ะฐะณะตะฝัะพะฒ, ะดะตะฟะปะพะน)
- ๐ก ะกััะธะผะธั ะฟัะพะณัะตัั ะฒัะฟะพะปะฝะตะฝะธั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ๐ ะฃะฟัะฐะฒะปัะตั ะผะฝะพะถะตััะฒะพะผ AI-ะฐะณะตะฝัะพะฒ ัะตัะตะท Agent Router

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
โ   Client    โโโโโโโโโโถโ   Gateway    โโโโโโโโโโถโ   Ollama    โ
โ (Telegram/  โ  WS     โ  :18789      โ  HTTP   โ :11434      โ
โ  Browser)   โโโโโโโโโโโ              โโโโโโโโโโโ gemini-3-f  โ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
                                โ
                                โผ
                        โโโโโโโโโโโโโโโโ
                        โ  CodeFoundry โ
                        โ  Workspace   โ
                        โโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
make install

# ะกะฑะพัะบะฐ TypeScript
make build

# ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
make dev
```

### Docker ัะตะถะธะผ

```bash
# ะะฐะฟััะบ ะฟะพะปะฝะพะณะพ ััะตะบะฐ (Gateway + Ollama)
make stack-up

# ะัะพัะผะพัั ะปะพะณะพะฒ
make stack-logs

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
make stack-status
```

## ๐ก WebSocket API

### ะกะพะพะฑัะตะฝะธั ะพั ะบะปะธะตะฝัะฐ

```typescript
// ะขะตะบััะพะฒะพะต ัะพะพะฑัะตะฝะธะต
{
  type: 'chat',
  content: 'ะกะพะทะดะฐะน ะฟัะพะตะบั telegram-bot ะดะปั ะดะพััะฐะฒะบะธ ะตะดั'
}

// Ping/pong
{
  type: 'ping'
}

// ะะพะดะฟะธัะบะฐ ะฝะฐ ะฟัะพะณัะตัั
{
  type: 'subscribe',
  events: ['progress', 'log', 'complete']
}
```

### ะกะพะพะฑัะตะฝะธั ะพั Gateway

```typescript
// ะัะพะณัะตัั ะฒัะฟะพะปะฝะตะฝะธั
{
  type: 'progress',
  stage: 'analyzing',
  progress: 50,
  message: 'ะะฝะฐะปะธะทะธััั ััะตะฑะพะฒะฐะฝะธั...'
}

// ะะตะทัะปััะฐั ะบะพะผะฐะฝะดั
{
  type: 'complete',
  sessionId: 'session_abc',
  content: {
    intent: 'create_project',
    result: { projectPath: '/workspace/test-bot' },
    duration: 5200
  }
}

// ะัะธะฑะบะฐ
{
  type: 'error',
  code: 'INTENT_PARSE_FAILED',
  message: 'ะะต ัะดะฐะปะพัั ัะฐัะฟะพะทะฝะฐัั ะบะพะผะฐะฝะดั'
}
```

## ๐ฏ ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะธะฝัะตะฝัั

| ะะฝัะตะฝั | ะขัะธะณะณะตัั | ะะฐัะฐะผะตััั |
|--------|----------|-----------|
| `create_project` | "ัะพะทะดะฐะน ะฟัะพะตะบั", "ะฝะพะฒัะน ะฟัะพะตะบั" | `project_type`, `name`, `location` |
| `generate_agents` | "ัะณะตะฝะตัะธััะน ะฐะณะตะฝัะฐ", "ัะพะทะดะฐะน ะฐะณะตะฝัะฐ" | `project_name`, `project_type` |
| `deploy` | "ะทะฐะดะตะฟะปะพะน", "ะดะตะฟะปะพะน" | `environment`, `project_name` |
| `help` | "ะฟะพะผะพัั", "ััะพ ัะผะตะตัั" | - |
| `status` | "ััะฐััั", "ัะพััะพัะฝะธะต" | `project_name?` |

## ๐ง ะะพะฝัะธะณััะฐัะธั

ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ัะผ. `.env.example`):

```bash
# Server
GATEWAY_PORT=18789
GATEWAY_HOST=0.0.0.0

# Ollama
OLLAMA_BASE_URL=http://ollama-service:11434
OLLAMA_MODEL=gemini-3-flash

# Workspace
WORKSPACE=/workspace
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะะฐะฟััะบ ัะตััะพะฒ
make test

# ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
make health

# ะขะตัั WebSocket
make test-websocket
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
gateway/
โโโ src/
โ   โโโ gateway.ts          # ะัะฝะพะฒะฝะพะน WebSocket ัะตัะฒะตั
โโโ dist/                   # ะกะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะน JS
โโโ scripts/
โ   โโโ start-gateway.sh    # ะกัะฐััะพะฒัะน ัะบัะธะฟั
โโโ Dockerfile.gateway      # Multi-stage Docker build
โโโ package.json            # ะะฐะฒะธัะธะผะพััะธ
โโโ tsconfig.json           # TypeScript ะบะพะฝัะธะณ
โโโ Makefile                # ะะพะผะฐะฝะดั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ .env.example            # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ
โโโ README.md               # ะญัะพั ัะฐะนะป
```

## ๐ ะะฝัะตะณัะฐัะธั

### ะก Telegram Bot

```typescript
const ws = new WebSocket('ws://gateway:18789');

ws.send(JSON.stringify({
  type: 'chat',
  content: message.text,
  userId: msg.from.id
}));
```

### ะก Claude Code

```typescript
// Claude Code ะฟะพะดะบะปััะฐะตััั ะบ Gateway
// ะดะปั AI-First ะธะฝัะตััะตะนัะฐ
```

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะธะฝัะตะฝัะฐ

1. ะะพะฑะฐะฒะธัั ะฒ `gateway.ts`:
```typescript
private async handleCustomIntent(intent: Intent, session: SessionContext) {
  // ะะพะณะธะบะฐ ะพะฑัะฐะฑะพัะบะธ
}
```

2. ะะฐัะตะณะธัััะธัะพะฒะฐัั ะฒ `executeIntent()`:
```typescript
case 'custom_intent':
  return this.handleCustomIntent(intent, session);
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะฐะณะตะฝัะฐ

ะกะผ. `../workspace/agents/agent-router.md` ะดะปั ะธะฝััััะบัะธะน.

## ๐ ะะพะฝะธัะพัะธะฝะณ

### Health check

```bash
curl http://localhost:18790/health
```

ะัะฒะตั:
```json
{
  "status": "healthy",
  "uptime": 3600,
  "sessions": 5,
  "ollama": "connected"
}
```

### ะะตััะธะบะธ

Gateway ัะพะฑะธัะฐะตั ะผะตััะธะบะธ:
- ะะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั ัะตััะธะน
- ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะบะพะผะฐะฝะด
- ะะฐะณััะทะบะฐ Ollama
- ะัะธะฑะบะธ ะฟะพ ัะธะฟะฐะผ

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- โ Non-root ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ Docker
- โ ะะฐะปะธะดะฐัะธั ะฒัะตั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- โ Rate limiting (ะฝะฐัััะพะนะบะฐ ัะตัะตะท ENV)
- โ ะัะบะปััะตะฝะธะต ะฝะตะธัะฟะพะปัะทัะตะผัั ะบะปะธะตะฝัะพะฒ

## ๐ Troubleshooting

### Gateway ะฝะต ััะฐัััะตั

```bash
# ะัะพะฒะตัะธัั ะฟะพัั
lsof -i :18789

# ะัะพะฒะตัะธัั ะปะพะณะธ
docker logs openclaw-gateway
```

### Ollama ะฝะตะดะพัััะฟะตะฝ

```bash
# ะัะพะฒะตัะธัั ะทะดะพัะพะฒัะต Ollama
curl http://localhost:11434/api/tags

# ะัะพะฒะตัะธัั Docker ัะตัั
docker network inspect openclaw-network
```

### WebSocket ะพัะบะปััะฐะตััั

- ะัะพะฒะตัััะต `SESSION_TIMEOUT`
- ะฃะฒะตะปะธัััะต `MAX_SESSIONS`
- ะัะพะฒะตัััะต ะปะพะณะธ ะฝะฐ ะพัะธะฑะบะธ

## ๐ License

MIT

## ๐ค Contributing

ะกะผ. `CONTRIBUTING.md` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ.
